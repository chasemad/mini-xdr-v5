#!/bin/bash
# Fix .env file issues

cd ./backend

echo "ðŸ”§ Fixing .env file issues..."

# Create backup
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# Fix the .env file
cat > .env << 'EOF'
# API Configuration
API_HOST=0.0.0.0
API_PORT=8000
UI_ORIGIN=http://localhost:3000
# PRODUCTION: Generate a secure 64+ character API key
API_KEY=WILL_BE_GENERATED_DURING_DEPLOYMENT

# Database
DATABASE_URL=sqlite+aiosqlite:///./xdr.db

# Detection Configuration
FAIL_WINDOW_SECONDS=60
FAIL_THRESHOLD=6
AUTO_CONTAIN=false

# T-Pot Honeypot Configuration - CORRECTED VALUES
HONEYPOT_HOST=34.193.101.171
HONEYPOT_USER=admin
HONEYPOT_SSH_KEY=~/.ssh/mini-xdr-tpot-key.pem
HONEYPOT_SSH_PORT=64295

# LLM Configuration
LLM_PROVIDER=openai
OPENAI_API_KEY=CONFIGURE_YOUR_OPENAI_KEY_HERE
OPENAI_MODEL=gpt-4o-mini
XAI_API_KEY=CONFIGURE_YOUR_XAI_KEY_HERE
XAI_MODEL=grok-beta

# Threat Intelligence APIs
ABUSEIPDB_API_KEY=CONFIGURE_IN_AWS_SECRETS_MANAGER
VIRUSTOTAL_API_KEY=CONFIGURE_IN_AWS_SECRETS_MANAGER

# Agent HMAC Credentials
CONTAINMENT_AGENT_DEVICE_ID=ffb56f4f-b0c8-4258-8922-0f976e536a7b
CONTAINMENT_AGENT_PUBLIC_ID=4fc980ee-4aab-4c46-a0a7-dd17d76ca26d
CONTAINMENT_AGENT_HMAC_KEY=678aae7bdf9e61cbb5fd059f0c774baf6d3143495cd091b2759265fe15c0beb3
CONTAINMENT_AGENT_SECRET=OcWEqM3hnJY1ruxrZFnK9OFlbWkWLNTh3FTLQBfZUCU

ATTRIBUTION_AGENT_DEVICE_ID=0f2940bd-fd59-45bd-b927-dca1b1dcf51a
ATTRIBUTION_AGENT_PUBLIC_ID=21f0fc1e-815a-45c0-ac5b-c5d4849aac36
ATTRIBUTION_AGENT_HMAC_KEY=ce3150d53ef292a474c692756376b8e6315ba31e40c8793ab6aa6492e0069a62
ATTRIBUTION_AGENT_SECRET=VSYKH1g2YN-BlQ4uPgh3kgDxu0QXedbf3adrfEWe-Jg

FORENSICS_AGENT_DEVICE_ID=bc677c66-1182-460d-937b-081ab629d388
FORENSICS_AGENT_PUBLIC_ID=0a20b961-33d8-4bc7-8734-60a063719f4e
FORENSICS_AGENT_HMAC_KEY=e519d9009cf0484c7d216d1158255ccb1567a4413ac73260031a8050711e7f83
FORENSICS_AGENT_SECRET=Bv9ZPk21eCNM_z10gRyWEBmLK22NOnhbEr5opo1y9g8

DECEPTION_AGENT_DEVICE_ID=2da20fd7-d04b-4787-b306-3e1c155d9e79
DECEPTION_AGENT_PUBLIC_ID=710e75aa-5966-4791-b3e9-d71f1a1165dd
DECEPTION_AGENT_HMAC_KEY=504579d868a87a8f3b2c981766d001a24ea524c0f878720685d47189001a2798
DECEPTION_AGENT_SECRET=N_l6Ifpt8OWMnfNJsN7fLtbzh3_cKw3A94kMHCVhw1A

HUNTER_AGENT_DEVICE_ID=3af431f7-2ec5-4fbd-ad63-5c94f0e59e02
HUNTER_AGENT_PUBLIC_ID=05bb0c02-a366-4c3f-8eff-d56e87150698
HUNTER_AGENT_HMAC_KEY=9c950674bd69832b2838ae576bbb50e9ce9247f6d127d1dc81c4a26ce842af60
HUNTER_AGENT_SECRET=LYl21D1ooRyTAJ_LYZ802zSOq9t0CQyZLAN0R8k31oA

ROLLBACK_AGENT_DEVICE_ID=f8cb21fd-8185-4109-bb1f-01c739022847
ROLLBACK_AGENT_PUBLIC_ID=e86d310a-6b98-46dd-ac9e-f2926b960dda
ROLLBACK_AGENT_HMAC_KEY=d854e940976739be6d764f27467174935611da358631fe89d8784d67981ebeab
ROLLBACK_AGENT_SECRET=1RRRp1GGiJfIQsVoNzPtj_cs7LOLcoKuuF5YQoY7PnQ

# T-Pot Integration Settings
TPOT_HOST=34.193.101.171
TPOT_SSH_PORT=64295
TPOT_WEB_PORT=64297
EOF

echo "âœ… .env file fixed!"
echo "ðŸ” Key changes made:"
echo "   â€¢ Fixed T-Pot connection settings"
echo "   â€¢ Removed duplicate API_KEY entries"
echo "   â€¢ Consolidated honeypot configuration"
echo "   â€¢ Kept all your existing agent credentials"
echo ""
echo "âš ï¸  SECURITY NOTE: Consider rotating API keys for production!"
